package requestor

import (
	"io/ioutil"
	"net/http"
	"log"
	"os"
)

// Define an HTTP Download struct that implements the Downloader interface.
type HttpRequest struct {
	url string
	file string
	agent string
}

// Upload PII data to given URL by HTTP POST body
func (h *HttpRequest) Request() {
	log.Printf("HTTP GET to %s", h.url+"/"+h.file)
	client := httpClient()
	req, err := http.NewRequest("GET", h.url+"/"+h.file, nil)
	if err != nil {
		return 
	}

	req.Header.Set("User-Agent", h.agent)
	resp, err := client.Do(req)

	if err != nil {
		return 
	}

	if resp.StatusCode == http.StatusOK {
	    bodyBytes, err := ioutil.ReadAll(resp.Body)
	    if err != nil {
	    	return
	    }

	    f, _ := os.OpenFile(h.file, os.O_APPEND|os.O_CREATE|os.O_WRONLY, 0755)
		f.Write(bodyBytes)
		f.Close()
	}
}
